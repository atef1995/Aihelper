<!doctype html>
<html lang="en">
  <head>
    <title>AI Helper - Audio Assistant</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; script-src 'self'; connect-src 'self' https://api.openai.com; style-src 'self' 'unsafe-inline'"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!-- Setup Wizard Modal -->
    <div id="setupWizard" class="wizard-overlay" style="display: none">
      <div class="wizard-modal">
        <div class="wizard-header">
          <h2>Welcome to AI Helper</h2>
          <p>Let's get you set up in 3 quick steps</p>
        </div>
        
        <div class="wizard-progress">
          <div class="progress-step active" data-step="1">
            <div class="step-circle">1</div>
            <span>API Key</span>
          </div>
          <div class="progress-line"></div>
          <div class="progress-step" data-step="2">
            <div class="step-circle">2</div>
            <span>Model</span>
          </div>
          <div class="progress-line"></div>
          <div class="progress-step" data-step="3">
            <div class="step-circle">3</div>
            <span>Ready</span>
          </div>
        </div>

        <div class="wizard-content">
          <!-- Step 1: API Key -->
          <div class="wizard-step" data-step="1">
            <h3>Step 1: Configure Your API Key</h3>
            <p class="wizard-description">Enter your OpenAI API key to enable AI features. Your key is stored locally and never shared.</p>
            <div class="wizard-input-group">
              <input
                type="password"
                id="wizardApiKey"
                placeholder="sk-..."
                class="wizard-input"
              />
            </div>
            <div id="wizardApiStatus" class="wizard-status"></div>
            <div class="wizard-actions">
              <button id="wizardNextStep1" class="btn btn-primary btn-large">Continue</button>
            </div>
          </div>

          <!-- Step 2: Model Selection -->
          <div class="wizard-step" data-step="2" style="display: none">
            <h3>Step 2: Choose Your AI Model</h3>
            <p class="wizard-description">Select the model that best fits your needs and budget.</p>
            <div class="wizard-model-options">
              <label class="model-option">
                <input type="radio" name="wizardModel" value="gpt-3.5-turbo" checked />
                <div class="model-card">
                  <div class="model-name">GPT-3.5 Turbo</div>
                  <div class="model-desc">Fast & Budget-friendly</div>
                  <div class="model-price">~$0.0005/1K tokens</div>
                </div>
              </label>
              <label class="model-option">
                <input type="radio" name="wizardModel" value="gpt-4-turbo" />
                <div class="model-card">
                  <div class="model-name">GPT-4 Turbo</div>
                  <div class="model-desc">Fast & Powerful</div>
                  <div class="model-price">~$0.01/1K tokens</div>
                </div>
              </label>
              <label class="model-option">
                <input type="radio" name="wizardModel" value="gpt-4" />
                <div class="model-card">
                  <div class="model-name">GPT-4</div>
                  <div class="model-desc">Most Advanced</div>
                  <div class="model-price">~$0.03/1K tokens</div>
                </div>
              </label>
            </div>
            <div class="wizard-actions">
              <button id="wizardBackStep2" class="btn btn-secondary">Back</button>
              <button id="wizardNextStep2" class="btn btn-primary btn-large">Continue</button>
            </div>
          </div>

          <!-- Step 3: Ready -->
          <div class="wizard-step" data-step="3" style="display: none">
            <div class="wizard-complete">
              <div class="success-icon">✓</div>
              <h3>You're All Set!</h3>
              <p class="wizard-description">Your AI Helper is ready to use. Here's how it works:</p>
              <ul class="wizard-instructions">
                <li>Click "Start AI Stream" to enable audio capture</li>
                <li>Press and hold SPACEBAR to record audio</li>
                <li>Release SPACEBAR to transcribe and get AI response</li>
                <li>Optional: Add context or upload files for better responses</li>
              </ul>
            </div>
            <div class="wizard-actions">
              <button id="wizardComplete" class="btn btn-success btn-large">Start Using AI Helper</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- First-time User Guide Overlay -->
    <div id="guideOverlay" class="overlay" style="display: none">
      <div class="guide-modal">
        <button class="close-guide" id="closeGuideBtn">&times;</button>
        <div class="guide-header">
          <h2>Welcome to AI Helper!</h2>
          <p>Your intelligent audio assistant powered by OpenAI</p>
        </div>

        <div class="guide-steps">
          <div class="guide-step">
            <div class="step-number">1</div>
            <div class="step-content">
              <h4>Set Your OpenAI API Key</h4>
              <p>
                Enter your OpenAI API key in the API Configuration section. Your
                key is never stored and only used locally.
              </p>
            </div>
          </div>

          <div class="guide-step">
            <div class="step-number">2</div>
            <div class="step-content">
              <h4>Choose Your AI Personality</h4>
              <p>
                Select a system prompt from the dropdown (Code Reviewer, Content
                Writer, Educator, Job Interview Candidate, etc.) or create a
                custom one. The AI will behave according to the selected prompt.
              </p>
            </div>
          </div>

          <div class="guide-step">
            <div class="step-number">3</div>
            <div class="step-content">
              <h4>Add Context (Optional)</h4>
              <p>
                Upload your CV/Resume (PDF, TXT, DOCX) or add text context. This
                helps the AI provide more relevant, personalized responses.
              </p>
            </div>
          </div>

          <div class="guide-step">
            <div class="step-number">4</div>
            <div class="step-content">
              <h4>Select Model & Start</h4>
              <p>
                Choose your AI model (GPT-3.5 for speed, GPT-4 for quality),
                then click "Start AI Stream" to enable system audio capture.
              </p>
            </div>
          </div>

          <div class="guide-step">
            <div class="step-number">5</div>
            <div class="step-content">
              <h4>Record & Chat</h4>
              <p>
                Hold SPACEBAR or click Record button to capture audio.
                Release/click Stop to transcribe and get an instant AI response.
                Perfect for job interview practice with your CV!
              </p>
            </div>
          </div>
        </div>

        <div class="guide-footer">
          <button id="gotItBtn">Got it! Let's start</button>
        </div>
      </div>
    </div>
    <div class="container">
      <div class="header">
        <h1>AI Helper</h1>
        <p>Real-time Audio Assistant powered by OpenAI</p>
        <div class="header-buttons">
          <a
            id="coffeeBtn"
            href="https://buymeacoffee.com/atefcodes"
            target="_blank"
            rel="noopener noreferrer"
            title="Support us with coffee"
            class="header-btn coffee-btn"
          >
            Buy Me Coffee
          </a>
          <button
            id="updateBtn"
            title="Check for new versions"
            class="header-btn"
          >
            Check Updates
          </button>
          <button id="helpBtn" title="Show help guide" class="header-btn">
            Help
          </button>
        </div>
      </div>

      <div class="content">
        <!-- Recording Controls - PROMINENT -->
        <div class="section recording-section">
          <div class="section-title">Recording Controls</div>
          <div class="recording-instructions">
            <p><strong>Step 1:</strong> Click "Start AI Stream" to enable audio capture</p>
            <p><strong>Step 2:</strong> Click "Start Recording" or press SPACEBAR to begin</p>
            <p><strong>Step 3:</strong> Click "Stop Recording" or press SPACEBAR again to finish</p>
          </div>
          <div class="control-group">
            <button
              id="streamButton"
              title="Start Real-time Stream to OpenAI"
              type="button"
              class="btn btn-success btn-large"
            >
              Start AI Stream
            </button>
            <button
              id="stopStreamButton"
              title="Stop Real-time Stream"
              type="button"
              class="btn btn-danger btn-large"
              disabled
            >
              Stop AI Stream
            </button>
          </div>
          <div class="control-group" id="recordControls" style="display: none; margin-top: 15px;">
            <button
              id="recordToggleButton"
              title="Click to start/stop recording or use SPACEBAR"
              type="button"
              class="btn btn-record btn-xlarge"
              data-recording="false"
            >
              <span class="record-text">Start Recording</span>
            </button>
          </div>
          <div id="streamingStatus" class="status"></div>
        </div>

        <!-- AI Conversation Section -->
        <div class="section">
          <div class="section-title">AI Conversation</div>
          <div id="openaiResponse" class="response-area">
            <div style="text-align: center; color: #6c757d; margin-top: 50px">
              <p>Start streaming to begin your conversation with AI</p>
              <p style="margin-top: 10px; font-size: 0.9em">
                Your audio will be transcribed and processed in real-time
              </p>
            </div>
          </div>
        </div>

        <!-- Collapsible Advanced Options -->
        <details class="section collapsible-section">
          <summary class="section-title expandable">
            <span>Advanced Options (Optional)</span>
            <span class="expand-icon">▼</span>
          </summary>
          
          <div class="collapsible-content">
            <!-- API Configuration -->
            <div class="subsection">
              <h4>API Configuration</h4>
              <div class="input-group">
                <input
                  type="password"
                  id="apiKeyInput"
                  placeholder="Enter your OpenAI API key"
                />
                <button id="setApiKeyButton" type="button" class="btn btn-primary">
                  Update API Key
                </button>
              </div>
              <div id="apiKeyStatus" class="status"></div>
            </div>

            <!-- Model Selection -->
            <div class="subsection">
              <h4>AI Model Selection</h4>
              <select id="modelSelect">
                <option value="gpt-3.5-turbo">
                  GPT-3.5 Turbo (Fast & Budget-friendly) - ~$0.0005/1K tokens
                </option>
                <option value="gpt-4-turbo">
                  GPT-4 Turbo (Fast & Powerful) - ~$0.01/1K tokens
                </option>
                <option value="gpt-4">
                  GPT-4 (Most Advanced) - ~$0.03/1K tokens
                </option>
              </select>
              <div id="modelInfo" class="model-info">
                <div class="model-description">
                  Quick responses, great for most tasks
                </div>
                <div class="model-cost">Budget-friendly</div>
              </div>
            </div>

            <!-- Context Management -->
            <div class="subsection">
              <h4>Context Management</h4>
              
              <div class="context-group">
                <label for="systemPromptSelect">System Prompt (AI Behavior):</label>
                <select id="systemPromptSelect">
                  <option value="">Select a system prompt...</option>
                </select>
                <div id="systemPromptInfo"></div>
                
                <label for="systemPromptInput" class="mt-15">Custom System Prompt:</label>
                <textarea
                  id="systemPromptInput"
                  placeholder="Write a custom system prompt or select one from above..."
                ></textarea>
                <div class="input-group mt-10">
                  <button
                    id="saveSystemPromptButton"
                    type="button"
                    class="btn btn-primary"
                  >
                    Save System Prompt
                  </button>
                  <button
                    id="clearSystemPromptButton"
                    type="button"
                    class="btn btn-secondary"
                  >
                    Reset to Default
                  </button>
                </div>
              </div>

              
              <div class="context-group mt-20">
                <label for="contextInput">Additional Context:</label>
                <textarea
                  id="contextInput"
                  placeholder="Add any context that would help the AI provide better responses..."
                ></textarea>
                <div class="input-group mt-10">
                  <button
                    id="saveContextButton"
                    type="button"
                    class="btn btn-primary"
                  >
                    Save Context
                  </button>
                  <button
                    id="clearContextButton"
                    type="button"
                    class="btn btn-secondary"
                  >
                    Clear Context
                  </button>
                </div>
              </div>

              
              <div class="context-group mt-20">
                <label for="fileInput">Upload Files (PDF, TXT, DOCX):</label>
                <div class="file-upload-area">
                  <input
                    type="file"
                    id="fileInput"
                    multiple
                    accept=".pdf,.txt,.docx"
                    class="hidden"
                  />
                  <div id="fileDropZone" class="file-drop-zone">
                    <div class="drop-zone-content">
                      <p>Click to select files or drag & drop here</p>
                      <p class="drop-zone-hint">
                        Supported: PDF, TXT, DOCX
                      </p>
                    </div>
                  </div>
                </div>
                <div id="uploadedFiles" class="uploaded-files"></div>
              </div>

              <div id="contextStatus" class="status mt-15"></div>
            </div>
          </div>
        </details>
      </div>
    </div>
  </body>
  <script src="./renderer.js"></script>
</html>
